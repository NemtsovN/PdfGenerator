# PdfGenerator

- [PdfGenerator](#pdfgenerator)
  - [General](#general)
  - [Investigation](#investigation)
    - [Investigated tools](#investigated-tools)
    - [Comparison Table](#comparison-table)
    - [Prototypes](#prototypes)
  - [Summary](#summary)

## General

Repository for a source code and documentation of PDF documents generation investigation.

## Investigation

> You can find detailed information about every investigated tool in [special folder.](/investigation/)

### Investigated tools

> Please note: final comparison table will include only tools that were not rejected during investigation.

- .NET
  - :white_check_mark: [SelectPDF](https://selectpdf.com/)
  - :x: [PdfSharp](https://github.com/empira/PDFsharp) - it is in preview and requires some custom code or extension to perform transformation of HTML to PDF (community-proposed extension HtmlRenderer is not maintained anymore).
  - :white_check_mark: [IronPdf](https://ironpdf.com/)
  - :x: [DinkToPdf](https://github.com/rdvojmoc/DinkToPdf) - the package is outdated: latest update 18.2017.
  - :white_check_mark: [iTextSharp](https://github.com/itext/itextsharp)
  - :x: [wkhtmltopdf](https://wkhtmltopdf.org/) - CLI that requires us to start additional process on a host. Besides there is a dependency on Qt WebKit.
  - :x: [PDFSharpCore](https://github.com/ststeiger/PdfSharpCore) - community-driven fork of PDFSharp that was transferred to a .NET Core. As well as the original library requires additional functionality to perform transformation.
  - :white_check_mark: [Syncfusion](https://www.syncfusion.com/document-processing/pdf-framework/net/html-to-pdf)
  - :white_check_mark: [DynamicPDF](https://www.dynamicpdf.com/)
  - :white_check_mark: [PuppeteerSharp](https://github.com/hardkoded/puppeteer-sharp)
  - :x: [NReco](https://www.nrecosite.com/pdf_generator_net.aspx) - paid wrapper library for wkhtmltopdf. Requires CLI tool to present on a machine.
- Node.js
  - :x: [Puppeteer](https://github.com/puppeteer/puppeteer) - depends on a headless browser. As there is a .NET implementation, this librariry will not be considered further.
  - :x: [html2pdf.js](https://github.com/eKoopmans/html2pdf.js) - fully client-side library.
  - :x: [jsPDF](https://parall.ax/products/jspdf) - good for transformation of HTML to PDF on a client-side as it requires DOM. Does not work on a backend, with no complex implementation of virtual DOM or headless browser.
  - :x: [html-pdf](https://github.com/marcbachmann/node-html-pdf) - package is deprecated.
  - :x: [pdfkit](https://pdfkit.org/) - good package for building PDF and not generation based on HTML. To generate PDF from HTML requies additional packages and the most popular is html-pdf.
- Python
  - :white_check_mark: [Weasyprint](https://weasyprint.org/)

### Comparison Table

We have selected a set of tools that do not have major concerns and seemed suitable for further investigation.

| Feature                              | SelectPDF                                                                                                                              | IronPDF                                                                                                         | iTextSharp                                                                                                | Syncfusion                                                                                                                                                                                                                                                        | DynamicPDF                                                                                                                                           | PuppeteerSharp                                                                     | Weasyprint                                                                                                        |
|--------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------|
| PDF generation based on HTML markup. | From a string, URL or a file.                                                                                                          | From a string, URL or a file.                                                                                   | From a string, file and Stream.                                                                           | From a string, file and Stream.                                                                                                                                                                                                                                   | From a string or URL.                                                                                                                                | From a URL, file or string.                                                        | From URL, file or string                                                                                          |
| Result PDF storage.                  | Stream or file.                                                                                                                        | Stream or file.                                                                                                 | Stream or file.                                                                                           | Stream or file.                                                                                                                                                                                                                                                   | Byte array.                                                                                                                                          | Stream, byte array or file                                                         | string or file.                                                                                                   |
| Features                             | [Feature list](https://selectpdf.com/pdf-library-for-net/)                                                                             | [Feature list](https://ironpdf.com/features/#html-file-to-pdf)                                                  | [Feature list](https://itextpdf.com/products/itext-7/convert-html-css-to-pdf-pdfhtml)                     | [Feature list](https://help.syncfusion.com/file-formats/pdf/overview#key-features-of-essential-pdf)                                                                                                                                                               | [Feature list](https://www.dynamicpdf.com/examples/dynamic-pdf-core-suite-generator-merger-reportwriter-.net)                                        | Features are limited. [Feature list](http://www.puppeteersharp.com/api/index.html) | Features are limited. [Feature list](https://doc.courtbouillon.org/weasyprint/stable/first_steps.html#quickstart) |
| Platform                             | Windows                                                                                                                                | Any Platform                                                                                                    | Any Platform (assumption is based on a fact that no documentation found that would specify limitation)    | Any platform. Requires specific Nuget package per environment due to a dependency on a Blink.                                                                                                                                                                     | Any system.                                                                                                                                          | Any system.                                                                        | Any system                                                                                                        |
| License                              | Commercial license: 499$-1599$ per 1 year. Community - available for commercial purposes but is limited with 5 pages in a document.    | Commercial license: 749$ - 2999$ per 1 year.                                                                    | Request is sent to product team                                                                           | 395$ per month per 5 developers. 695$ per month per 10 developers. More than 10 developers - should be discussed with sales. There are licenses per application, [but should be discussed with sales as well](https://www.syncfusion.com/sales/unlimitedlicense). | 449$ per developer per year. There is an option for perpetual license that includes minor/major updates during the first year. 879$ per 1 developer. | Free (MIT license)                                                                 | Free (BSD-3 license)                                                                                              |
| Open-source                          | No                                                                                                                                     | No                                                                                                              | Yes                                                                                                       | No                                                                                                                                                                                                                                                                | No                                                                                                                                                   | Yes                                                                                | Yes                                                                                                               |
| Community activity                   | 237 search results on StackOverflow                                                                                                    | 211 search results on StackOverflow                                                                             | 1.3k starts on a GitHub. 500 search results on StackOverflow                                              | No possibility to identify the amount of StackOverflow questions due to variety of tools provided by company.                                                                                                                                                     | Approximately 120 results on a StackOverflow.                                                                                                        | Approximately 180 results on a StackOverflow.                                      | Approximately 500 results on a StackOverflow.                                                                     |
| Update frequency                     | Development is active, new version approximately every 3 month. The latest version has been published on 08/062023.                    | Active development. New version approximately every month. The latest version has been published on 02/06/2023. | Partially active development. New version approximately every 3-5 month. The latest release on 10/05/2023 | Active development. New version every 1-2 weeks. The latest release on 13/06/2023.                                                                                                                                                                                | Partially active development. New version every 2-4 month. The latest release on 01/06/2023.                                                         | Active development. New release every 2-3 month. The latest release on 05/05/2023  | Active development. New release every 2-3 weeks. The latest release on 11/05/2023                                 |
| Number of downloads                  | 2.7 million.                                                                                                                           | 6.2 million.                                                                                                    | 4.2 million.                                                                                              | Total downloads (for every type of OS package): 23 9879                                                                                                                                                                                                           | 109.9K downloads                                                                                                                                     | 7.1M downloads                                                                     | No possibility to verify.                                                                                         |
| Overall rating                       | :star: :star:                                                                                                                          | :star: :star: :star:                                                                                            | :star: :star: :star: :star:                                                                               | :star: :star: :star:                                                                                                                                                                                                                                              | :star: :star: :star:                                                                                                                                 | :star: :star: :star: :star:                                                        | :star: :star: :star: :star:                                                                                       |

### Prototypes

Based on a comparison table, we have decided to perform further investigation and prototyping.

A list of selected tools contain:

- [iText](https://itextpdf.com/products/itext-7/convert-html-css-to-pdf-pdfhtml). According to a comparison table this is one of the most advanced tools for PDF generation.
- [NReco](https://www.nrecosite.com/pdf_generator_net.aspx). A .NET wrapper for wkhtmltopdf CLI tool. It is partially opposite of web browser based approaches and is very popular itself. Due these facts, we decided that it can be a good candidate for prototype.
- [PuppeteerSharp](https://www.puppeteersharp.com/). One of the most popular approaches, with a great community. Open-source and free.
- Custom wapper for [wkhtmltopdf](https://wkhtmltopdf.org/). Our own implementation of a wrapper provided in different libraries. It is a good candidate to estimate performance of tool as well as perform further investigations.
- [Weasyprint](https://weasyprint.org/). Python based tooling that is open-source and has a great community.

For each of these tools, we have created a [prototype](/prototypes/) and performed benchmark to get main metrics. Besides benchmarking we will also estimate documentation and development effort to implement code.

> Benchmarking has been performed on [HTML inputs](/prototypes/PdfGenerator.Prototypes/benchmarks/Benchmarks/Stubs).

| Feature                                                      | PuppeteerSharp                                                                                                                                                                                   | iText                                                                                                                                                                                                                                                                                     | Wkhtmltopdf wrapper                                                                                                                                                | NReco                                                                                                                                                      | Weasyprint                                                         |
|--------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------|
| Mean time to generate PDF from HTML                          | 628.06 ms                                                                                                                                                                                        | 74.31 ms                                                                                                                                                                                                                                                                                  | 1,194.24 ms                                                                                                                                                        | 1,162.65 ms                                                                                                                                                | 585.00 ms.                                                         |
| Allocated memory by application                              | 3639.39 KB                                                                                                                                                                                       | 48698.01 KB                                                                                                                                                                                                                                                                               | 220.15 KB                                                                                                                                                          | 142.63 KB                                                                                                                                                  | 79100 KB                                                           |
| Allocated memory by Docker container (including application) | ≈483400 KB                                                                                                                                                                                       | ≈83000 KB                                                                                                                                                                                                                                                                                 | ≈80740 KB                                                                                                                                                          | ≈10650 KB                                                                                                                                                  | N/A                                                                |
| Development effort                                           | Medium effort. It is required to prepare Chromium browser that will be used during generation. It can be downloaded in code, but in future it should be prepared before running the application. | Minimal effort. Transformation code is easy to read and modify.                                                                                                                                                                                                                           | Maximum effort. We had to setup separate process as well as configure CLI arguments and read the output.                                                           | Minimal effort.                                                                                                                                            | Minimal effort.                                                    |
| Testing potential                                            | Weak potential for unit testing. At the same time, e2e-testing can be performed. The only thing to keep in mind is availability of Chromium in automated pipeline.                               | No interfaces provided by library, so unit testing can be complex. Complex types of testing seem possible due to independency of a solution.                                                                                                                                              | Potentially possible to perform unit testing as all types are .NET common. Complex types of testing can be non-trivial as would require CLI on a pipeline machine. | No interfaces provided by library, so unit testing can be complex. Complex types of testing can be non-trivial as would require CLI on a pipeline machine. | No team experience in Python code unit testing.                    |
| Documentation quality                                        | Detailed documentation as well as interfaces definition.                                                                                                                                         | Documentation is not enough detailed, complex examples are missing. Github issues are not available. Interfaces definition is available as well as developer portal with asked questions (but the amount of questions is small).                                                          | Documentation is detailed and well defined. GitHub issues are available as well as CLI definition.                                                                 | Minimal documentation that is limited with the only one page. Interface definitions are available.                                                         | Rich documentation. GitHub issues are available.                   |
| Community support                                            | Great amount of articles as well as community support via GitHub issues.                                                                                                                         | Community forum that makes possible to iText developers to answer questions in a form of articles. There is no information about answering speed and the amount of questions/answers is limited. No other community support except of general-purpose forums (as StackOverflow) is found. | Great community support for a based Wkhtmltopdf library. Available GitHub issues and dedicated articles.                                                           | No real community support as the solution is not open-source.                                                                                              | Rich community support.                                            |
| Deployment complexity                                        | High. Requires an approach that will speed up downloading of headless web browser. It can be baked in EC2 instance or can be delivered through a Lambda Layers.                                  | Low. Seems to bring no additional tools, so should be possible to deploy just as a Nuget that is restored.                                                                                                                                                                                | High. Requires CLI tool to present on a machine. It can be baked in EC2 instance or can be delivered through a Lambda Layers.                                      | High. Requires CLI tool to present on a machine. It can be baked in EC2 instance or can be delivered through a Lambda Layers.                              | Minimal. Requires Python pipeline and dependencies installed only. |

Besides just benchmarking of solutions, we have compared them by functionality:

| Feature                                                    | PuppeteerSharp      | iText                                                             | Wkhtmltopdf wrapper                                               | NReco               | Weasyprint         |
|------------------------------------------------------------|---------------------|-------------------------------------------------------------------|-------------------------------------------------------------------|---------------------|--------------------|
| Custom fonts                                               | :white_check_mark:  | :white_check_mark:                                                | :white_check_mark:                                                | :white_check_mark:  | :white_check_mark: |
| Image as URL                                               | :white_check_mark:  | :white_check_mark:                                                | :white_check_mark:                                                | :white_check_mark:  | :white_check_mark: |
| Image as SVG                                               | :white_check_mark:  | :white_circle: Image has been rendered but with a missing margin. | :white_circle: Image has been rendered but with a missing margin. | :white_check_mark:  | :white_check_mark: |
| Tables                                                     | :white_check_mark:  | :white_check_mark:                                                | :white_check_mark:                                                | :white_check_mark:  | :white_check_mark: |
| Lists                                                      | :white_check_mark:  | :white_check_mark:                                                | :white_check_mark:                                                | :white_check_mark:  | :white_check_mark: |
| CSS                                                        | :white_check_mark:  | :white_circle: Image has been rendered but with a missing margin. | :white_circle: Image has been rendered but with a missing margin. | :white_check_mark:  | :white_check_mark: |
| HTML elements generated with a help of Javascript on load. | :white_check_mark:  | :x:                                                               | :x:                                                               | :white_check_mark:  | :white_check_mark: |

## Summary

